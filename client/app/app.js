'use strict';

var translationsEN = {
  "add": "Add",
  "author_add": "Add an author",
  "author_select": "Select an author",
  "authors": "Authors",
  "author-s": "Author(s)",
  "authors_community": "possible author(s) in this community",
  "home": "Home",
  "admin": "Admin",
  "attachments": "Attachments",
  "attachments_add": "Add an attachment",
  "attachments_drop": "... or drag and drop files here.",
  "attachments_drop_notSupported": "Drag and drop is not supported by your browser.",
  "attachments_image_not": "There is no image attachment on this contribution.",
  "attach": "Attach",
  "build-on": "Build-on",
  "close": "Close",
  "communities": "Communities",
  "community": "Community",
  "community_enter": "Enter community",
  "community_join": "Join Community",
  "community_possible": "possible communitie(s)",
  "community_registration_key": "Community Registration Key",
  "community_select": "Select community",
  "connections": "Connections",
  "contribute": "Contribute",
  "contribution_connection_buildsOnto": "This contribution builds onto",
  "contribution_connection_builtOnto": "This contribution is built onto by",
  "contribution_connection_references": "This contribution references",
  "contribution_connection_referencedBy" : "This contribution is referenced by",
  "contribution_connection_views": "View(s) for this note",
  "contribution_success": "Contribution Succeeded.",
  "contribution_continueEditing": "Continue editing",
  "contribution_finish": "Finish editing (Close this window)",
  "createdBy": "Created by",
  "delete": "Delete",
  "download": "Download",
  "edit": "Edit",
  "edit_logs": "Edit logs",
  "error": "Error",
  "feature_not_currently_available": "This feature is not currently available.",
  "firstName": "First Name",
  "group": "Group",
  "group members": "Group members",
  "history": "History",
  "join": "Join",
  "kbc_myKBCsTitle": "My Knowledge Building Communities",
  "keyword-s": "Keyword(s)",
  "email": "Email",
  "language": "Language",
  "language_modify": "Modify language",
  "language_select": "Select language",
  "lastName": "Last Name",
  "lastModified": "Last modified",
  "loading...": "Loading...",
  "login": "Login",
  "login_error_nameAndPass": "Please enter your username and password.",
  //"login_error_email": "Please enter a valid email.",
  "login_signup_invite": "If you don't have an account, you can create one by following this link",
  "logout": "Logout",
  "manage": "Manage",
  "note_connection_supportedBy": "This note is supported by",
  "open": "Open",
  "openInInternal": "Ouvrir in internal",
  "openInTab": "Open in tab",
  "openInWindow": "Open in window",
  "password": "Password",
  "password_modify": "Modify password",
  "password_current": "Current password",
  "password_new": "New password",
  "password_restrictions": "Password must be at least 4 characters.",
  "position_fix": "Fix position",
  "position_unfix": "Unfix position",
  "properties": "Properties",
  "read": "Read",
  "read_logs": "Read logs",
  "recovery": "Recovery",
  "register": "Register",
  "registration_key": "Registration key",
  "registration_key_invalid": "Invalid registration key.",
  "register_error_firstName" : "A first name is required.",
  "register_error_lastName": "A last name is required.",
  "register_error_email_invalid": "Doesn't look like a valid email.",
  "register_error_email_required": "An email address is required.",
  "register_error_username_required": "A username is required.",
  "rise-above_create": "Create a Rise-above note",
  "save": "Save",
  "scaffolds": "Scaffolds",
  "technical_data": "Technical data",
  "title_placeholder": "Put your title here.",
  "title_required": "Please write a title.",
  "upload": "Upload",
  "user_agent": "User Agent",
  "username": "Username",
  "tools": "Tools",

};

var translationsFR = {
  "add": "Ajouter",
  "authors": "Auteurs",
  "author-s": "Auteur(s)",
  "author_add": "Ajouter un auteur",
  "author_select": "Sélectionnez un auteur",
  "authors_community": "auteur(s) possible(s) dans cette communauté",
  "attachments": "Pièce(s) jointe(s)",
  "attachments_add": "Ajouter une pièce jointe",
  "attachments_drop": "... ou glisser-déposer le(s) fichier(s) ici.",
  "attachments_drop_notSupported": "Le glisser-déposer n'est pas pris en charge par votre navigateur.",
  "attachments_image_not": "Il n'y a pas d'image jointe à cette contribution.",
  "attach": "Joindre",
  "home": "Accueil",
  "admin": "Administration",
  "build-on": "Élaborer",
  "close": "Fermer",
  "contribution_connection_buildsOnto": "Cette contribution élabore",
  "contribution_connection_builtOnto": "Cette contribution est élaborée par celle(s)-ci",
  "contribution_connection_references": "Cette contribution référence",
  "contribution_connection_referencedBy" : "Cette contribution est référencée par",
  "contribution_connection_views": "Perspective(s) contenant cette contribution",
  "communities": "Communautés",
  "community": "Communauté",
  "community_enter": "Accéder à la commmunauté",
  "community_join": "Joindre une communauté",
  "community_possible": "communauté(s) possible(s)",
  "community_registration_key": "Code d'adhésion",
  "community_select": "Sélectionnez une communauté",
  "connections": "Liens",
  "contribute": "Contribuer",
  "contribution_success": "Vous avez contribué avec succès.",
  "contribution_continueEditing": "Poursuivre l'édition",
  "contribution_finish": "Terminer l'édition (fermer cette fenêtre)",
  "createdBy": "Créé(e) par",
  "delete": "Supprimer",
  "download": "Télécharger",
  "edit": "Éditer",
  "edit_logs": "Révisions",
  "error": "Erreur",
  "feature_not_currently_available": "Cette fonction n'est pas disponible pour l'instant.",
  "firstName": "Prénom",
  "group": "Groupe",
  "group members": "Membres du groupe",
  "history": "Historique",
  "join": "Joindre",
  "kbc_myKBCsTitle": "Mes communautés d'élaboration de connaissances (CoÉco)",
  "keyword-s": "Mot(s)-clé(s)",
  "email": "Courriel",
  "language": "Langue",
  "language_modify": "Modifier la langue",
  "language_select": "Sélectionnez une langue",
  "lastName": "Nom",
  "lastModified": "Dernière modification",
  "loading..." : "Chargement en cours...",
  "login": "Connexion",
  "login_error_nameAndPass" : "Veuillez saisir votre nom d'utilisateur et mot de passe.",
  //"login_error_email" : "Veuillez saisir une adresse de courriel valide.",
  "login_signup_invite": "Si vous n'avez pas de compte, vous pouvez en créer un en suivant ce lien",
  "logout": "Déconnexion",
  "manage" : "Gérer",
  "note_connection_supportedBy": "Cette note est appuyée par",
  "open": "Ouvrir",
  "openInInternal": "Ouvrir à l'intérieur",
  "openInTab": "Ouvrir dans un onglet",
  "openInWindow": "Ouvrir dans une fenêtre",
  "password": "Mot de passe",
  "password_modify": "Modifier mon mot de passe",
  "password_current": "Mot de passe actuel",
  "password_new": "Nouveau mot de passe",
  "password_restrictions": "Le mot de passe doit contenir au moins 4 caractères.",
  "position_fix": "Verrouiller la position",
  "position_unfix": "Déverrouiller la position",
  "properties": "Propriétés",
  "read": "Lire",
  "read_logs": "Lectures",
  "recovery": "Récupération",
  "register": "Inscription",
  "registration_key": "Code d'inscription",
  "registration_key_invalid": "Code d'inscription invalide.",
  "register_error_firstName" : "Veuillez saisir un prénom.",
  "register_error_lastName": "Veuillez saisir un nom.",
  "register_error_email_invalid": "Veuillez saisir une adresse de courriel valide.",
  "register_error_email_required": "Une adresse de courriel est requise.",
  "register_error_username_required": "Un nom d'utilisateur est requis.",
  "rise-above_create": "Créer une note Élever-le-propos",
  "save": "Enregistrer",
  "scaffolds": "Échafaudages",
  "upload": "Téléverser",
  "user_agent": "Agent utilisateur",
  "username": "Nom d'utilisateur",
  "technical_data": "Données techniques",
  "title_placeholder": "Veuillez rédiger un titre.",
  "title_required": "Veuillez rédiger un titre.",
  "tools": "Outils"
};

angular.module('kf6App', [
        'ngCookies',
        'ngResource',
        'ngSanitize',
        'btford.socket-io',
        'ui.router',
        'ui.bootstrap',
        'ui.tinymce',
        'ui.sortable',
        'angularFileUpload',
        'ng-context-menu',
        'ui.select',
        'pascalprecht.translate'
    ])
    .config(function($stateProvider, $urlRouterProvider, $locationProvider, $httpProvider) {
        $urlRouterProvider.otherwise('/');

        /* handling url */
        $urlRouterProvider.when('/uploads/:xxx', function($urlRouter, $state, $location) {
            window.location = $location.url();
            return true;
        });

        $locationProvider.html5Mode(true);
        $httpProvider.interceptors.push('authInterceptor');
    })

    .config(['$translateProvider', function($translateProvider) {
        $translateProvider
          .translations('en', translationsEN)
          .translations('fr', translationsFR)
          .preferredLanguage('fr')
          .fallbackLanguage('en');
          //.determinePreferredLanguage();
    }])
  .controller('LanguageCtrl', function ($scope, $translate) {
  $scope.changeLanguage = function (key) {
    console.log('proposedLanguage', $translate.proposedLanguage());
    console.log('new language', key);
    $translate.use(key);
  };
})


.factory('authInterceptor', function($rootScope, $q, $cookieStore, $location) {
    return {
        // Add authorization token to headers
        request: function(config) {
            config.headers = config.headers || {};
            if ($cookieStore.get('token')) {
                config.headers.Authorization = 'Bearer ' + $cookieStore.get('token');
            }
            return config;
        },

        // Intercept 401s and redirect you to login
        responseError: function(response) {
            if (response.status === 401) {
                $location.path('/login');
                // remove any stale tokens
                $cookieStore.remove('token');
                return $q.reject(response);
            } else {
                return $q.reject(response);
            }
        }
    };
})

.run(function($rootScope, $location, Auth) {
    // Redirect to login if route requires auth and you're not logged in
    $rootScope.$on('$stateChangeStart', function(event, next) {
        Auth.isLoggedInAsync(function(loggedIn) {
            if (next.authenticate && !loggedIn) {
                $location.path('/login');
            }
        });
    });
});
